<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>animate-on-scroll</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="main.css">
</head>

<body>
    <section class="video-scroll-section">
        <video id="video-1" class="video pos-sticky" data-duration="5" loop muted autoplay playsinline
            poster="./Pexels-Videos-2715.png">
            <source src="./Pexels-Videos-2715.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>

        <div id="dummy-1" class="scroll-dummy scroll-dummy-offset-title-mask">
            <h1 class="scroll-dummy-title">animate(video) on scroll</h1>
            <p>
                在捲動頁面時加入動畫、動態效果，在 Apple 產品頁很常看見
            </p>
            <p class="p-spacing">
                實際上製作起來應該都是透過 video 的前進、後退完成</p>
            <p class="p-spacing"></p>
            <p>也就是設定影片的 play current time<br>
                頁面下捲時影片向前播放, 頁面上捲時影片後退。<br>
                利用視覺效果，完成使用者的回朔感
            </p>
            <p class="p-spacing"></p>
            <p class="p-spacing">
                javascript 在控制影片時，需要計算其影片的長度 (duration) 和 frames，讓頁面的效果有較好的體驗<br>
                ps: 需要配合影片的 framerate
            </p>
            <p class="p-spacing">
                簡單來說，影片內容直接影響使用者在頁面上的視覺影驗(影片過快或過慢)<br>
            </p>
            <p>
                設定頁面捲動與影片播放 frames, fps
            </p>
            <div class="p-spacing">
                <p>
                    example:</p>
                <pre><code class="code-js javascript"
                    style="font-size:18px;height: 300px;">
    const playbackConst = 500; // lower numbers = faster playback

    .
    .
    .

    function scrollPlay() {
        video1.currentTime = getVideoScrollContainerY(dummy1) / playbackConst;

        window.requestAnimationFrame(scrollPlay);
    }
    window.requestAnimationFrame(scrollPlay);
                </code></pre>
            </div>
            <p class="p-spacingp">
                參考連結:
                <ul>
                    <li>
                        <del><a href="https://codepen.io/charliezstong-pro/pen/YzPrdXV" target="_blank">codepen AirPods
                                Pro 捲動範例</a></del>
                    </li>
                    <li>
                        <a href="https://codepen.io/ollieRogers/pen/lfeLc/?editors=1010" target="_blank">
                            requestAnimationFrame 搭配捲動範例</a>
                    </li>
                    <li>
                        註: <a href="https://www.quora.com/How-many-frames-in-a-2-minute-animation" target="_blank">
                            frame 計算方式
                        </a></li>
                    <li>
                        all video from:
                        <a href="https://www.pexels.com/search/videos/laptop/" target="_blank">www.pexels.com</a>
                    </li>
                </ul>
            </p>
        </div>
    </section>

    <section class="video-scroll-section">
        <video id="video-2" class="video pos-sticky" data-starttime="2" data-duration="4" loop muted autoplay muted
            playsinline poster="./typing-on-keyboard-of-macbook-pro-852295.png">
            <source src="./typing-on-keyboard-of-macbook-pro-852295.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>

        <div id="dummy-2" class="scroll-dummy scroll-dummy-offset-title-mask">
            <h2 class="scroll-dummy-title">section-2</h2>
            <p>
                注意影片長度與大小，截入速度造成使用者體驗不同<br>
                若一定要使用較大的影片，記得指定良好的 video poster(preview photo)
                <p>可以讓影片在載入不破壞畫面(ux)</p>
                <p class="p-spacing"></p>
                <p>
                    這個範例中的 video tag 使用 position sticky
                </p>
                <p>
                    <pre><code class="code-js css"
                    style="font-size:18px;height: 240px;">
    .pos-sticky {
        display: block;
        position: -webkit-sticky;
        position: sticky;
        will-change: transform;

        left: 0;
        top: 0;
    }
                    </code>
                    </pre>
                    擔心瀏覽器不支援的話，可以加入 polyfill<br>
                    polyfill position sticky:
                    <a href="https://github.com/yowainwright/stickybits" target="_blank">
                        https://github.com/yowainwright/stickybits</a>
                </p>

        </div>
    </section>

    <section class="video-scroll-section">
        <video id="video-3" class="video pos-sticky" muted loop muted autoplay playsinline
            poster="https://lqez.github.io/js/airpodsvf/video.jpg">
            <source src="https://lqez.github.io/js/airpodsvf/video.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div id="dummy-3" class="scroll-dummy scroll-dummy-offset-title-mask">
            <h2 class="scroll-dummy-title">
                video section-3
            </h2>
            <p>this video from github(codepen example)</p>
            <p>
                第二個重點，影片與文字內容區塊兩者相依
            </p>
            <p class="p-spacing">
                文字區塊關系到影片出場時機(捲動出頁面)</p>
            <p>
                如果文字區塊 height 不足，影片還沒播放到重點就出場了...<br>
                也就是文字區塊的高度(長度)不夠
                <p class="p-spacing">
                    因此這個影片的附屬區塊下面留白較多
                </p>
                <p class="p-spacing">
                    當然~ 選擇合適的影片是其中最重要因素</p>
                <p class="p-spacing"></p>
                <p>而影片的播放也速度(frame,fps)也有相對關係<br>
                    這部份目前還在找正確的計算方式...
                </p>
                <p>
                    在這整個範例裡<br>
                    使用 tag section 做為影片與文字區塊的容器<br>
                    其中有兩個主要子容器，分別為 video 與 div
                </p>
                <p>
                    <pre><code class="code-js javascript"
                        style="font-size:18px;height: 360px;">
    // set text container height
    textContainer.style.minHeight =
        textContainer.style.maxHeight =
            Math.ceil(getVideoDuration(video))
            * playbackConst
            + getViewportHeight()
            + 'px';
    .
    .
    .

    // get custom video duration
    const getVideoDuration = elem => {
        return elem.dataset.duration || elem.duration || null;
    }
                </code></pre>
                </p>
        </div>
    </section>

    <section class="video-scroll-section">
        <div class="scroll-dummy disable-scroll-dummy-after">
            <h3 class="">無影片區塊</h3>
            <p>佔位文字</p>
            <p>Besides, SHE'S she, and I'm I, and--oh dear, how puzzling it all seemed quite dull and stupid for life to
                go
                on in the pool a little way off, and she swam about, trying to find that she was walking hand in her
                pocket,
                and pulled out a box of comfits, (luckily the salt water had not got into it), and handed them round as
                prizes.
            </p>
            <p class="p-spacing">
                `But it's no use their putting their heads down and began to cry again. `Mine is a long and a
                sad
                tale!' said the Lory hastily. How queer everything is queer to-day.' Just then she heard a
                little way
                off,
                and she jumped up on to her feet in a long, low hall, which was lit up by a row of lamps hanging
                from
                the
                roof.
            </p>
            <p>`I must be shutting up like a telescope! So she began: `O Mouse, do you know the way I want to
                go! `I
                quite forgot you didn't like cats.' </p>

            <p class="p-spacing">
                Incididunt laborum culpa aliqua deserunt Lorem quis laborum irure cupidatat. Nostrud consequat irure
                nulla amet aliqua voluptate sit nisi enim Lorem dolor laborum tempor. Officia quis commodo tempor ipsum
                laborum elit laborum nulla deserunt eiusmod nostrud.
            </p>
            <footer class="copyright-footer">
                github: <a href="https://github.com/cscolabear/video-on-scroll" target="_blank">
                    https://github.com/cscolabear/video-on-scroll</a><br>

            </footer>
        </div>
    </section>
</body>
<!-- https://gist.github.com/geddski/1649729, requestAnimationFrame polyfill -->
<script>
    // http://paulirish.com/2011/requestanimationframe-for-smart-animating/
    // http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating

    // requestAnimationFrame polyfill by Erik Möller
    // fixes from Paul Irish and Tino Zijdel

    (function () {
        var lastTime = 0;
        var vendors = ['ms', 'moz', 'webkit', 'o'];
        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
            window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
            window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||
                window[vendors[x] + 'RequestCancelAnimationFrame'];
        }

        if (!window.requestAnimationFrame || !window
            .cancelAnimationFrame) //current Chrome (16) supports request but not cancel
            window.requestAnimationFrame = function (callback, element) {
                var currTime = new Date().getTime();
                var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                var id = window.setTimeout(function () {
                        callback(currTime + timeToCall);
                    },
                    timeToCall);
                lastTime = currTime + timeToCall;
                return id;
            };

        if (!window.cancelAnimationFrame)
            window.cancelAnimationFrame = function (id) {
                clearTimeout(id);
            };
    }());

</script>
<script src="main.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/a11y-dark.min.css">
<script>
    document.querySelectorAll('.code-js').forEach(elem => {
        hljs.highlightBlock(elem);
    });

</script>

</html>
